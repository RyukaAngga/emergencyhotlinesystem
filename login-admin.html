<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Login - Emergency System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #ffffff 0%, #fee2e2 50%, #fecaca 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .login-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(220, 38, 38, 0.15);
            padding: 40px;
            width: 100%;
            max-width: 420px;
            border: 2px solid #fee2e2;
        }

        .login-header {
            text-align: center;
            margin-bottom: 35px;
        }

        .login-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #dc2626 0%, #ef4444 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            box-shadow: 0 8px 20px rgba(220, 38, 38, 0.3);
        }

        .login-icon i {
            font-size: 36px;
            color: white;
        }

        .login-header h1 {
            font-size: 28px;
            color: #dc2626;
            margin-bottom: 8px;
            font-weight: 700;
        }

        .login-header p {
            color: #6b7280;
            font-size: 14px;
        }

        .form-group {
            margin-bottom: 24px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #374151;
            font-weight: 600;
            font-size: 14px;
        }

        .input-wrapper {
            position: relative;
        }

        .input-wrapper i {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: #9ca3af;
            font-size: 16px;
        }

        .form-group input {
            width: 100%;
            padding: 14px 16px 14px 48px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            font-size: 15px;
            transition: all 0.3s;
            font-family: inherit;
        }

        .form-group input:focus {
            outline: none;
            border-color: #dc2626;
            box-shadow: 0 0 0 4px rgba(220, 38, 38, 0.1);
        }

        .form-group input::placeholder {
            color: #9ca3af;
        }

        input:-webkit-autofill,
        input:-webkit-autofill:hover,
        input:-webkit-autofill:focus,
        input:-webkit-autofill:active {
            -webkit-box-shadow: 0 0 0 30px white inset !important;
            box-shadow: 0 0 0 30px white inset !important;
            -webkit-text-fill-color: #111827 !important;
            transition: background-color 5000s ease-in-out 0s;
        }

        input::-webkit-credentials-auto-fill-button {
            visibility: hidden;
            display: none !important;
            pointer-events: none;
            height: 0;
            width: 0;
            margin: 0;
        }

        .login-button {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #dc2626 0%, #ef4444 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3);
            margin-top: 24px;
        }

        .login-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(220, 38, 38, 0.4);
        }

        .login-button:active {
            transform: translateY(0);
        }

        .login-button:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .alert {
            padding: 12px 16px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 14px;
            display: none;
            animation: slideDown 0.3s ease;
        }

        .alert-error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fecaca;
        }

        .alert-success {
            background: #dcfce7;
            color: #166534;
            border: 1px solid #bbf7d0;
        }

        .alert i {
            margin-right: 8px;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .loading-spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin-right: 8px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .back-link {
            text-align: center;
            margin-top: 24px;
        }

        .back-link a {
            color: #6b7280;
            text-decoration: none;
            font-size: 14px;
            transition: color 0.3s;
        }

        .back-link a:hover {
            color: #dc2626;
        }

        .back-link i {
            margin-right: 6px;
        }

        @media (max-width: 480px) {
            .login-container {
                padding: 30px 24px;
            }

            .login-header h1 {
                font-size: 24px;
            }

            .login-icon {
                width: 70px;
                height: 70px;
            }

            .login-icon i {
                font-size: 32px;
            }
        }
    </style>
</head>
<body>
    <div class="login-container">
        <div class="login-header">
            <div class="login-icon">
                <i class="fas fa-shield-halved"></i>
            </div>
            <h1>Admin Login</h1>
            <p>Emergency System Control Panel</p>
        </div>

        <div id="alertBox" class="alert"></div>

        <form id="loginForm" autocomplete="off">
            <div class="form-group">
                <label for="email">Email Address</label>
                <div class="input-wrapper">
                    <i class="fas fa-envelope"></i>
                    <input 
                        type="text" 
                        id="email" 
                        name="preventautofill-email" 
                        placeholder="admin@example.com"
                        required
                        autocomplete="off"
                        autocorrect="off"
                        autocapitalize="off"
                        spellcheck="false"
                        readonly
                        onfocus="this.removeAttribute('readonly');"
                    >
                </div>
            </div>

            <div class="form-group">
                <label for="password">Password</label>
                <div class="input-wrapper">
                    <i class="fas fa-lock"></i>
                    <input 
                        type="password" 
                        id="password" 
                        name="preventautofill-password" 
                        placeholder="••••••••"
                        required
                        autocomplete="off"
                        autocorrect="off"
                        autocapitalize="off"
                        spellcheck="false"
                        readonly
                        onfocus="this.removeAttribute('readonly');"
                    >
                </div>
            </div>

            <button type="submit" class="login-button" id="loginBtn">
                <span id="btnText">Login</span>
            </button>
        </form>

        <div class="back-link">
            <a href="dashboard.html">
                <i class="fas fa-arrow-left"></i>
                Back to Dashboard
            </a>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <script>

        const SUPABASE_URL = 'https://fvayuhanwcwinkvvvisk.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZ2YXl1aGFud2N3aW5rdnZ2aXNrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk5MDk1NTYsImV4cCI6MjA3NTQ4NTU1Nn0.AP0ZYsrUQ1ACD7fmX1wTM88_zzMtvyKXmgc9wCVvRrM';

        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY, {
            auth: {
                persistSession: true,
                autoRefreshToken: true
            }
        });

        const loginForm = document.getElementById('loginForm');
        const emailInput = document.getElementById('email');
        const passwordInput = document.getElementById('password');
        const loginBtn = document.getElementById('loginBtn');
        const btnText = document.getElementById('btnText');
        const alertBox = document.getElementById('alertBox');

        function disableAutofill() {

            emailInput.setAttribute('autocomplete', 'off');
            passwordInput.setAttribute('autocomplete', 'off');

            emailInput.setAttribute('data-lpignore', 'true');
            passwordInput.setAttribute('data-lpignore', 'true');

            emailInput.setAttribute('data-form-type', 'other');
            passwordInput.setAttribute('data-form-type', 'other');
        }

        disableAutofill();

        emailInput.addEventListener('mousedown', (e) => {
            emailInput.blur();
            setTimeout(() => emailInput.focus(), 1);
        });

        passwordInput.addEventListener('mousedown', (e) => {
            passwordInput.blur();
            setTimeout(() => passwordInput.focus(), 1);
        });

        async function clearSession() {
            try {

                const { data: { session } } = await supabase.auth.getSession();
                
                if (session) {

                    await supabase.auth.signOut();
                }
            } catch (error) {

            }

            localStorage.clear();
            sessionStorage.clear();
        }

        clearSession();

        function showAlert(message, type = 'error') {
            alertBox.className = `alert alert-${type}`;
            alertBox.innerHTML = `
                <i class="fas fa-${type === 'error' ? 'exclamation-circle' : 'check-circle'}"></i>
                ${message}
            `;
            alertBox.style.display = 'block';

            setTimeout(() => {
                alertBox.style.display = 'none';
            }, 5000);
        }

        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            const email = emailInput.value.trim();
            const password = passwordInput.value;

            if (!email || !password) {
                showAlert('Please fill in all fields', 'error');
                return;
            }

            loginBtn.disabled = true;
            btnText.innerHTML = '<span class="loading-spinner"></span>Logging in...';

            try {

                const { data, error } = await supabase.auth.signInWithPassword({
                    email: email,
                    password: password,
                });

                if (error) {
                    throw error;
                }

                showAlert('Login successful! Redirecting...', 'success');

                emailInput.value = '';
                passwordInput.value = '';

                setTimeout(() => {
                    window.location.href = 'admin.html';
                }, 1000);

            } catch (error) {
                
                let errorMessage = 'Login failed. Please try again.';
                
                if (error.message.includes('Invalid login credentials')) {
                    errorMessage = 'Invalid email or password';
                } else if (error.message.includes('Email not confirmed')) {
                    errorMessage = 'Please verify your email first';
                } else if (error.message) {
                    errorMessage = error.message;
                }

                showAlert(errorMessage, 'error');

                loginBtn.disabled = false;
                btnText.textContent = 'Login';
            }
        });

        [emailInput, passwordInput].forEach(input => {
            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    loginForm.dispatchEvent(new Event('submit'));
                }
            });
        });

        let autoRedirectTimer = null;
        const AUTO_REDIRECT_TIME = 3 * 60 * 1000; // 3 menit

        function startAutoRedirect() {
            if (autoRedirectTimer) {
                clearTimeout(autoRedirectTimer);
            }

            autoRedirectTimer = setTimeout(() => {
                window.location.href = 'scan.html';
            }, AUTO_REDIRECT_TIME);
        }

        function resetAutoRedirect() {
            startAutoRedirect();
        }

        ['click', 'touchstart', 'mousemove', 'keypress'].forEach(event => {
            document.addEventListener(event, resetAutoRedirect, { passive: true });
        });

        emailInput.value = '';
        passwordInput.value = '';

        setTimeout(() => {
            emailInput.value = '';
            passwordInput.value = '';
        }, 100);
        
        setTimeout(() => {
            emailInput.value = '';
            passwordInput.value = '';
        }, 300);
        
        setTimeout(() => {
            emailInput.value = '';
            passwordInput.value = '';
        }, 500);

        window.addEventListener('load', () => {

            emailInput.value = '';
            passwordInput.value = '';
            
            setTimeout(() => {
                emailInput.value = '';
                passwordInput.value = '';
            }, 50);
            
            setTimeout(() => {
                emailInput.value = '';
                passwordInput.value = '';
            }, 200);
            
            startAutoRedirect(); // Mulai timer auto redirect
        });

        document.addEventListener('visibilitychange', () => {
            if (document.visibilityState === 'visible') {
                emailInput.value = '';
                passwordInput.value = '';
            }
        });

        window.addEventListener('pageshow', (event) => {
            emailInput.value = '';
            passwordInput.value = '';
        });
    </script>

    <script src="kiosk-mode.js"></script>
</body>
</html>
